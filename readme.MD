# UWDR

## Что такое UWDR?

### Краткое описание проекта
UWDR (*United Weather Data Registry*) - информационная система "Единый реестр погодных данных",
которая получает данные о погоде, обрабатывает их и строит инфографику на их основе.

### Из чего состоит проект
Информационная система UWDR состоит из нескольких компонентов, а именно:
1. Docker - платформа для работы с контейнерами (виртуальными машинами).
Необходима для запуска и работы всех используемых сервисов.
2. Clickhouse - колоночная база данных, использующаяся для записи обработки и хранения больших данных.
В проекте используется в качестве основной БД для работы с погодными данными.
3. Airflow - сервис для создания, выполнения и мониторинга потоков операций, основной компонент которого является DAG (Ориентированный ациклический граф).
В информационной системе используется для регулирования загрузок и обработок в БД Clickhouse по расписанию.
4. Grafana - программная система визуализации данных, реализованная в виде веб-приложения. Используется для мониторинга погодных данных.
5. API - Сторонний сервис для получения данных в виде JSON и XML файлов. Необходим для получения сырых погодных данных.

## Запуск и работа с проектом

### Системные требования
Для корректной работы UWDR, необходимо:
1. Установленную операционную систему Microsoft Windows 10 x64 Home.
2. Установленное и настроенное приложение Docker Desktop.
3. Процессор Intel Core I5 10 поколения.
4. 32 Гб оперативной памяти DDR4.
5. 50 Гб свободного места на диске SSD.

### Запуск проекта
Для запуска проекта UWDR, необходимо проделать следующие шаги:
1. Запустить приложение Docker Desktop.
2. В директории с проектом открыть командную строку (CMD).
3. Выполнить следующий код в CMD: `docker build -t extending_airflow .`, дождаться выполнения команды.
4. Выполнить следующий код в CMD: `docker-compose up -d`.
5. Дождаться загрузки Airflow, когда можно будет перейти по адресу `http://localhost:8080`.
6. Войти в систему Airflow с помощью стандартной логинки `airflow airflow`.
7. Перейти в раздел Admins, Variables.
8. Выбрать файл, который находится по пути `airflow/init/variables.json`, после чего нажать `Import Variables`.
9. Войти в систему Grafana с помощью стандартной логинки `admin admin`
10. Поменять при необходимости пароль
11. Зайти в раздел Dashboard, нажать New Dashboard
12. Кликнуть Import Dashboard, импортировать json файлы которые находятся по пути `grafana/init/...`

<details>
  <summary>Для разработчиков</summary>

1. Для редактирования или добавления новых переменных в AF необходимо отредактировать файл `variables.json` и повторить пункты 7-8.
2. Для добавления новых библиотек на python необходимо отредактировать файл `requirements.txt` и повторить пункт 3-4.
3. Для добавления новых дашбордов в grafana необходимо сделать share, затем export и нажать кнопку `View JSON`, после чего скопировать изменения в нужный файл по пути `grafana/lib/dashboards`
4. Для проверки стиля кода необходимо установить flake8 (если его нет) через команду `pip install flake8`. Запускается через консоль проекта, с помощью команды `flake8`.

</details>

### Остановка проекта
Для корректной остановки проекта существует два корректных варианта:
1. Выполнить следующий код в CMD: `docker-compose stop`. **ВНИМАНИЕ** команда `docker-compose down` может стереть данные на проекте!
2. Остановить проект UWDR в приложении Docker Desktop, нажав на кнопку stop.